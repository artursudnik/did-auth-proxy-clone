server {
    listen       80;
    listen  [::]:80;
    server_name  _;

    location = /auth {
        proxy_pass http://auth-server/auth;
    }

    location = /auth/login {
        proxy_pass http://auth-server/auth/login;
    }

    location = /auth/refresh-token {
        proxy_pass http://auth-server/auth/refresh-token;
    }

    location / {
        auth_request /token_introspection;
        proxy_pass http://backend;
    }

    location = /token_introspection {
        internal;
        proxy_method      GET;
        proxy_set_header  Authorization "$http_authorization";
        proxy_set_header  Content-Length "";
        proxy_pass        http://auth-server/auth/token-introspection;
    }
}
